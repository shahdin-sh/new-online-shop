{% extends '_base.html' %}
{% load humanize %}
{% load custom_intcomma %}

{% block content %}
    <!-- breadcrumb-area start -->
    {% include "breadcrumb.html" %}
    <!-- breadcrumb-area end -->
    <div id="main-wrapper">
        <div class="site-wrapper-reveal border-bottom">
            <div class="my-account-page-warpper section-space--ptb_120">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <!-- My Account Page Start -->
                            <div class="myaccount-page-wrapper">
                                <div class="row">

                                    <!-- My Account Tab Menu Start -->
                                    <div class="col-lg-3 col-md-4">
                                        <div class="myaccount-tab-menu nav" role="tablist">
                                            <a href="#dashboad" class="active" data-bs-toggle="tab"><i class="fa fa-dashboard"></i>
                                                داشبورد</a>
                                            <a href="#orders" data-bs-toggle="tab"><i class="fa fa-cart-arrow-down"></i> سفارشات</a>
                                            <a href="#download" data-bs-toggle="tab"><i class="fa fa-cloud-download"></i> دانلود</a>
                                            <a href="#payment-method" data-bs-toggle="tab"><i class="fa fa-credit-card"></i> روش پرداخت</a>
                                            <a href="#address-edit" data-bs-toggle="tab"><i class="fa fa-map-marker"></i>جزئیات آدرس</a>
                                            <a href="#account-info" data-bs-toggle="tab"><i class="fa fa-user"></i> جزئیات حساب</a>
                                            <a href="login.html"><i class="fa fa-sign-out"></i> خروج</a>
                                        </div>
                                    </div>
                                    <!-- My Account Tab Menu End -->

                                    <!-- My Account Tab Content Start -->
                                    <div class="col-lg-9 col-md-8">
                                        <div class="tab-content" id="myaccountContent">

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3 class="title">داشبورد</h3>
                                                    <div class="welcome">
                                                        <p>سلام <strong>{{user.username}}</strong> (اگر شما <strong>{{user.username}}</strong> نیستید! <a href={% url 'account_logout' %} class="logout">خارج شوید.</a>)</p>
                                                    </div>
                                                    <p class="mb-0">لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحان گرافیک است چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است.</p>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="orders" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3 class="title">سفارشات</h3>
                                                    <div class="myaccount-table table-responsive text-center">
                                                        <table class="table table-bordered">
                                                            <thead class="thead-light">
                                                                <tr>
                                                                    <th>سفارش</th>
                                                                    <th>تاریخ</th>
                                                                    <th>وضعیت</th>
                                                                    <th>جمع</th>
                                                                    <th>جزئیات</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                            {% for order in user_orders %}
                                                                <tr>
                                                                    <td>{{order.id}}</td>
                                                                    <td>{{order.datetime_created}}</td>
                                                                    <td>{{order.order_status}}</td>
                                                                    <td>{{order.get_order_total_price|custom_intcomma}} تومان</td>
                                                                    <td><a class="btn btn btn-dark btn-hover-primary btn-sm rounded-0">مشاهده</a></td>
                                                                </tr>
                                                            {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="download" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3 class="title">دانلود ها</h3>
                                                    <div class="myaccount-table table-responsive text-center">
                                                        <table class="table table-bordered">
                                                            <thead class="thead-light">
                                                                <tr>
                                                                    <th>محصول</th>
                                                                    <th>تاریخ</th>
                                                                    <th>انقضا</th>
                                                                    <th>دانلود</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>لورم ایپسوم متن ساختگی با تولید سادگی</td>
                                                                    <td>25 آبان 1401</td>
                                                                    <td>بله</td>
                                                                    <td><a href="#" class="btn btn btn-dark btn-hover-primary rounded-0"><i class="fa fa-cloud-download me-1"></i> دریافت فایل</a></td>
                                                                </tr>
                                                                <tr>
                                                                    <td>لورم ایپسوم متن ساختگی با تولید سادگی</td>
                                                                    <td>7 آذر 1401</td>
                                                                    <td>هرگز</td>
                                                                    <td><a href="#" class="btn btn btn-dark btn-hover-primary rounded-0"><i class="fa fa-cloud-download me-1"></i> دریافت فایل</a></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="payment-method" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3 class="title">روش پرداخت</h3>
                                                    <p class="saved-message">در حال حاضر امکان ذخیره روش پرداخت وجود ندارد.</p>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="address-edit" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <form action={% url 'orders:create_and_update_customer' %} method='post'>
                                                        {% csrf_token %}
                                                        <div class="billing-info-wrap mr-100">
                                                                <h3 class="title">جزئیات آدرس</h3>
                                                                    <div class="col-lg-6 col-md-6"> 
                                                                        <div class="billing-info mb-25"> 
                                                                            {% comment %} <label>نام&nbsp;<span class="required" title="required">*</span>
                                                                            </label>                                                      {% endcomment %}
                                                                            <input type="hidden" name='first_name' value="{{user.customer_info.first_name|safe}}" required> 
                                                                        </div>                                                 
                                                                    </div>
                                                                                                                 
                                                                <div class="col-lg-6 col-md-6"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        {% comment %} <label>نام خانوادگی&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                      {% endcomment %}
                                                                        <input type="hidden" name='last_name' value="{{user.customer_info.last_name|safe}}" required> 
                                                                    </div>                                                 
                                                                </div>
                                                                <div class="col-lg-12 col-md-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        {% comment %} <label>ایمیل&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                      {% endcomment %}
                                                                        <input type="hidden" name='email' value={{user.customer_info.email|safe}} required> 
                                                                    </div>                                                 
                                                                </div>                                  
                                                                <div class="col-lg-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        <label>نام شرکت (اختیاری)&nbsp;
                                                                        </label>                                                     
                                                                        <input type="text" name='company' value="{{user.customer_info.company|safe}}"> 
                                                                    </div>                                                 
                                                                </div>                                             
                                                                <div class="col-lg-12"> 
                                                                    <div class="billing-select mb-25"> 
                                                                        <label>
                                                                            <span class="required" title="required" required><font color="#000000">کشور&nbsp;</font>*</span>
                                                                        </label>                                                     
                                                                        <select class="select-active" name='country'>
                                                                            <option value="IRAN" {% if user.customer_info.country == 'IRAN' %}selected{% endif %}>ایران</option>
                                                                            <option value="IRAQ" {% if user.customer_info.country == 'IRAQ' %}selected{% endif %}>عراق</option>
                                                                            <option value="BAHRAIN" {% if user.customer_info.country == 'BAHRAIN' %}selected{% endif %}>بحرین</option>
                                                                            <option value="UAE" {% if user.customer_info.country == 'UAE' %}selected{% endif %}>امارات</option>
                                                                            <option value="TURKEY" {% if user.customer_info.country == 'TURKEY' %}selected{% endif %}>ترکیه</option>
                                                                        </select>                                                       
                                                                    </div>                                            
                                                                </div>                                             
                                                                <div class="col-lg-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        <label>آدرس&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                     
                                                                        <input class="billing-address" placeholder="الهیه،خیابان فرشته، پلاک 124 واحد 1" type="text" name='address' value="{{user.customer_info.address|safe}}" required> 
                                                                        {% comment %} <input placeholder="پلاک و شماره واحد" type="text" name='address'/>  {% endcomment %}
                                                                    </div>                                                 
                                                                </div>                                             
                                                                <div class="col-lg-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        <label>شهر&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                     
                                                                        <input type="text" name='town' value="{{user.customer_info.town|safe}}" required> 
                                                                    </div>                                                 
                                                                </div>                                                                                         
                                                                <div class="col-lg-12 col-md-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        <label>کد پستی&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                     
                                                                        <input type="text" name='zip_code' value="{{user.customer_info.zip_code|safe}}" required> 
                                                                    </div>                                                 
                                                                </div>                                             
                                                                <div class="col-lg-12 col-md-12"> 
                                                                    <div class="billing-info mb-25"> 
                                                                        <label>تلفن&nbsp;<span class="required" title="required">*</span>
                                                                        </label>                                                     
                                                                        <input type="text" name='phone_number' value="{{user.customer_info.phone_number|safe}}" required> 
                                                                    </div>                                                 
                                                                </div>               
                                                            {% if user.customer_info %}
                                                                <button type='submit' class="btn btn btn-dark btn-hover-primary rounded-0"><i class="fa fa-edit me-2"></i>ویرایش اطلاعات</button>
                                                            {% else %}
                                                                <button type='submit' class="btn btn btn-dark btn-hover-primary rounded-0"><i class="fa fa-edit me-2"></i>ثبت اطلاعات</button>
                                                            {% endif %}
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            <!-- Single Tab Content End -->

                                            <!-- Single Tab Content Start -->
                                            <div class="tab-pane fade" id="account-info" role="tabpanel">
                                                <div class="myaccount-content">
                                                    <h3 class="title">جزئیات حساب</h3>
                                                    <div class="account-details-form">
                                                        <form action={% url 'account:edit_profile' %} method='post'>
                                                            {% csrf_token %}
                                                            <div class="row">
                                                                <input type=hidden name='date_joined' value='{{current_time}}'/>
                                                                <div class="col-lg-6">
                                                                    <div class="single-input-item mb-3">
                                                                        <label for="first-name" class="required mb-1">نام</label>
                                                                        <input type="text" id="first-name" name="first_name" placeholder="نام" value='{{request.user.first_name}}' />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="single-input-item mb-3">
                                                                        <label for="last-name" class="required mb-1">نام خانوادگی</label>
                                                                        <input type="text" id="last-name" name="last_name" placeholder="نام خانوادگی" value='{{request.user.last_name}}' />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="single-input-item mb-3">
                                                                <label for="display-name" class="required mb-1">نام نمایشی</label>
                                                                <input type="text" id="display-name" name="username" placeholder="نام نمایشی" value='{{request.user.username}}' />
                                                            </div>
                                                            <div class="single-input-item mb-3">
                                                                <label for="email" class="required mb-1">آدرس ایمیل</label>
                                                                <input type="email" id="email" name="email" placeholder="آدرس ایمیل" value='{{request.user.email}}' />
                                                            </div>
                                                            <div class="single-input-item single-item-button">
                                                                <button type='submit' class="btn btn btn-dark btn-hover-primary rounded-0">ذخیره تغییرات</button>
                                                            </div>
                                                        </form>
                                                        <br>
                                                        <form action={% url 'account:change_password' %} method='post'>
                                                            {% csrf_token %}
                                                            <fieldset>
                                                                <legend>تغییر گذرواژه</legend>
                                                                <div class="single-input-item mb-3">
                                                                    <label for="current-pwd" class="required mb-1">گذرواژه فعلی</label>
                                                                    <input name='old_password' type="password" id="current-pwd" placeholder="گذرواژه فعلی" />
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-lg-6">
                                                                        <div class="single-input-item mb-3">
                                                                            <label for="new-pwd" class="required mb-1">گذرواژه جدید</label>
                                                                            <input name='new_password1' type="password" id="new-pwd" placeholder="گذرواژه جدید" />
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <div class="single-input-item mb-3">
                                                                            <label for="confirm-pwd" class="required mb-1">تکرار گذرواژه جدید</label>
                                                                            <input name='new_password2' type="password" id="confirm-pwd" placeholder="تکرار گذرواژه جدید" />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="single-input-item single-item-button">
                                                                    <button type='submit' class="btn btn btn-dark btn-hover-primary rounded-0">تغییر رمز عبور</button>
                                                                </div> 
                                                            </fieldset>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div> <!-- Single Tab Content End -->

                                        </div>
                                    </div>
                                    <!-- My Account Tab Content End -->

                                </div>
                            </div>
                            <!-- My Account Page End -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
{% endblock content%}